<div class="page-container">
	<app-sidebar page="league" [league]="league">
	</app-sidebar>
	<div class="page-content">
		<div *ngIf="league && league.status == 0;else leagueDetail" style="height: 100%;">
			<app-league-waiting-overlay [league]="league"></app-league-waiting-overlay>
		</div>
		<ng-template #leagueDetail>
			<div class="uk-container uk-margin-top">
				<div class="uk-text-lead">League #{{league.league_id}}</div>
				<div class="uk-margin-top card-container uk-grid-small uk-grid-match" uk-grid>
					<app-portfolio
						[clickCallback]="portfolioClicked"
						[hideCards]="portfolioOpened"
						[class.uk-width-1-2@m]="!portfolioOpened"
						[class.uk-width-1-1@m]="portfolioOpened"
						class="uk-animation-slide-left">
					</app-portfolio>
					<div class="uk-width-1-2@m">
						<div *ngIf="!hideCards" class="uk-card uk-card-secondary uk-card-small uk-card-body uk-animation-slide-right" [class.uk-animation-reverse]="portfolioOpened">
							<h3 class="uk-card-title">Stats & Distribution</h3>
							<div class="uk-flex uk-flex-bottom uk-card-body">
								<div uk-grid *ngIf="!hideCards">
									<ul class="uk-list uk-list-large">
									    <li>Your Rank: #{{rank}}</li>
									    <li>Most Gains (24h): {{leader}}</li>
											<!-- <li>League status: {{status}}</li> -->
											<li>{{timeRemaining}} until the league {{status}}</li>
									</ul>
									<ul class="uk-list uk-list-large">
										<li><b>Prize Distribution:</b></li>
									    <li>#1 - #{{length / 10}}: 50</li>
									    <li>#{{length / 10 + 1}} - #{{length / 4}}: 37.5</li>
									    <li>#{{length / 4 + 1}} - #{{length / 2}}: 25</li>
									</ul>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="uk-container uk-card-small uk-margin-top uk-margin-large-bottom uk-animation-slide-bottom" [class.uk-animation-reverse]="portfolioOpened" *ngIf="!hideCards">
					<div class="uk-card uk-card-default uk-card-body">
						<div class="uk-flex uk-flex-between">
							<div>
								<h3 class="uk-card-title">League Leaderboard</h3>
							</div>
							<div *ngIf="loadingLeague;else other_content">
								<div uk-spinner></div>
							</div>
							<ng-template #other_content><span uk-icon="refresh" class="uk-button" (click)="loadLeague()"></span></ng-template>
						</div>
						<div class="uk-container uk-table-striped uk-margin-top uk-overflow-auto">
							<table class="uk-table uk-margin-top uk-table-divider uk-table-middle">
							    <thead>
							        <tr>
							            <th *ngIf="league.status >= 2">Rank</th>
							            <th></th>
							            <th>Username</th>
							            <th *ngIf="league.status >= 2">Total Gains</th>
							            <th>Tokens</th>
							        </tr>
							    </thead>
							    <tr *ngFor="let user of league.portfolio_ids">
							     	<td *ngIf="league.status >= 2">{{user.rank}}</td>
							     	<td><span class="uk-icon uk-icon-image uk-margin-right" [ngStyle]="{'background-image': 'url(' + user.profilePicture +')'}"></span></td>
							     	<td>{{user.username}}</td>
						        <td *ngIf="league.status >= 2" [class.uk-text-success]="user.portfolio_value > 0" [class.uk-text-danger]="user.portfolio_value < 0">
						        	<span *ngIf="user.portfolio_value > 0;else negChange" uk-icon="triangle-up"></span>
											<ng-template #negChange>
												<span uk-icon="triangle-down"></span>
											</ng-template>
											{{user.portfolio_value | number:'1.2-2'}}
										</td>
						        <td>{{user.tokens}}</td>
						        </tr>
							</table>
						</div>
					</div>
				</div>
			</div>

			<div class="progress-bar" [class.starting]="league.status == 1" [class.started]="league.status == 3" >
				<div class="progress" [style.width]="timeRemainingPercent + '%'" [class.starting]="league.status == 1" [class.started]="league.status == 3"></div>
				<p>{{timeRemaining}} until the league {{status}}</p>
			</div>
		</ng-template>
	</div>
</div>
